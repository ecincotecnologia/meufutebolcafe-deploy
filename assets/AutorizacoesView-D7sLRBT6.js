import{d as z,r as s,o as k,c,b as t,g as h,t as l,w as E,f as w,v as A,e as N,F as R,j as T,a as _,s as g,h as m,k as C}from"./index-CebFxVPd.js";import{a as D}from"./mask-BwaD9nz2.js";const L={class:"container margin-top-navbar"},B={class:"row"},F={class:"col-12"},M={class:"col-12 col-md-3"},U={class:"col-12 col-md-3 d-grid align-items-end"},V=["disabled"],j={key:0,class:"alert alert-danger"},S={class:"table-responsive"},$={class:"table text-nowrap table-dark table-striped"},O={class:"row mt-3"},G={class:"col"},P=["disabled"],J=z({__name:"AutorizacoesView",setup(Y){const r=s(new Date().getFullYear()),v=s(0),p=s([]),i=s(!1),u=s(!1),d=s("");function b(o){if(!o)return"";const a=new Date(o);return Number.isNaN(a.getTime())?"":a.toLocaleDateString("pt-BR")}async function f(){i.value=!0,d.value="";try{const{data:o}=await _.get("/autorizacao",{params:{ano:r.value}});p.value=Array.isArray(o?.dados)?o.dados:[],v.value=Number(o?.total??p.value.length)}catch{d.value="Erro ao carregar autorizacoes.",g("Erro ao carregar autorizacoes.","danger")}finally{i.value=!1}}async function y(){u.value=!0;try{const o=await _.get("/autorizacao/excel",{params:{ano:r.value},responseType:"blob"}),a=new Blob([o.data],{type:"application/vnd.ms-excel;charset=utf-8"}),e=window.URL.createObjectURL(a),n=document.createElement("a"),x=o.headers["content-disposition"]?.match(/filename="?([^"]+)"?/);n.href=e,n.download=x?.[1]||`autorizacoes-atletas-${r.value}.xls`,document.body.appendChild(n),n.click(),n.remove(),window.URL.revokeObjectURL(e)}catch{g("Erro ao exportar autorizacoes.","danger")}finally{u.value=!1}}return k(()=>{f()}),(o,a)=>(m(),c("main",L,[t("div",B,[t("div",F,[a[5]||(a[5]=t("h3",null,"Autorizacoes de atletas",-1)),t("p",null,[a[1]||(a[1]=h(" Existem ",-1)),t("strong",null,l(v.value),1),a[2]||(a[2]=h(" atletas com autorizacoes pelo responsavel ",-1))]),t("form",{class:"row g-2 mb-3",onSubmit:E(f,["prevent"])},[t("div",M,[a[3]||(a[3]=t("label",{for:"ano",class:"form-label"},"Ano",-1)),w(t("input",{id:"ano","onUpdate:modelValue":a[0]||(a[0]=e=>r.value=e),type:"number",class:"form-control",min:"2000",max:"2100"},null,512),[[A,r.value,void 0,{number:!0}]])]),t("div",U,[t("button",{class:"btn btn-secondary",type:"submit",disabled:i.value},l(i.value?"Filtrando...":"Filtrar"),9,V)])],32),d.value?(m(),c("div",j,l(d.value),1)):N("",!0),t("div",S,[t("table",$,[a[4]||(a[4]=t("thead",null,[t("tr",null,[t("th"),t("th",null,"Atleta"),t("th",null,"RG"),t("th",null,"Nascimento"),t("th",null,"Telefone"),t("th",null,"Pai"),t("th",null,"Mae"),t("th",null,"Autorizado por"),t("th",null,"Telefone"),t("th",null,"Email"),t("th",null,"Clube/Escola"),t("th",null,"Autorizado em"),t("th",null,"Chave")])],-1)),t("tbody",null,[(m(!0),c(R,null,T(p.value,(e,n)=>(m(),c("tr",{key:`${e.key}-${n}`},[t("td",null,l(n+1),1),t("td",null,l(e.atleta),1),t("td",null,l(C(D)(e.rg)),1),t("td",null,l(b(e.nascimento)),1),t("td",null,l(e.telefone_atleta),1),t("td",null,l(e.nome_pai),1),t("td",null,l(e.nome_mae),1),t("td",null,l(e.responsavel),1),t("td",null,l(e.telefone),1),t("td",null,l(e.email),1),t("td",null,l(e.clube_escola),1),t("td",null,l(b(e.autorizado_em)),1),t("td",null,l(e.key),1)]))),128))])])]),t("div",O,[t("div",G,[t("button",{type:"button",class:"btn w-100 btn-info text-white",disabled:u.value,onClick:y},l(u.value?"Exportando...":"Exportar"),9,P)])])])])]))}});export{J as default};
