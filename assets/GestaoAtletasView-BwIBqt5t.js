import{d as U,r,o as V,c as d,b as a,g as w,t as l,w as F,f as x,v as M,m as N,F as k,j as E,e as A,a as C,s as g,h as i,k as S}from"./index-CebFxVPd.js";import{a as T}from"./mask-BwaD9nz2.js";const j={class:"container margin-top-navbar"},B={class:"row"},G={class:"col-12"},$={class:"row g-2 align-items-end"},D={class:"col-12 col-md-2"},q={class:"col-12 col-md-8"},O=["value"],Y={class:"col-12 col-md-2 d-grid"},z=["disabled"],H={class:"row my-3"},I={class:"d-grid gap-1 col"},J=["disabled"],K={key:0,class:"alert alert-danger"},P={key:1,class:"table-responsive"},Q={class:"table table-striped table-dark nowrap"},ea=U({__name:"GestaoAtletasView",setup(W){const u=r(new Date().getFullYear()),m=r([]),s=r([]),c=r([]),f=r(0),p=r(""),v=r(!1),b=r(!1);function h(){return{temporada:u.value,id_temporada:s.value.join(",")}}async function _(){v.value=!0,p.value="";try{const{data:o}=await C.get("/atleta/gestao",{params:h()});m.value=Array.isArray(o?.temporadas)?o.temporadas:[],c.value=Array.isArray(o?.atletas)?o.atletas:[],f.value=Number(o?.total??c.value.length),s.value.length===0&&m.value.length>0&&(s.value=m.value.map(e=>Number(e.id_temporada)))}catch{p.value="Erro ao carregar gestao de atletas.",g("Erro ao carregar gestao de atletas.","danger")}finally{v.value=!1}}async function y(){await _()}async function L(){if(s.value.length===0){g("Selecione ao menos uma temporada.","warning");return}b.value=!0;try{const o=await C.get("/atleta/gestao/excel",{params:h(),responseType:"blob"}),e=new Blob([o.data],{type:"application/vnd.ms-excel;charset=utf-8"}),t=window.URL.createObjectURL(e),n=document.createElement("a"),R=o.headers["content-disposition"]?.match(/filename="?([^"]+)"?/);n.href=t,n.download=R?.[1]||`gestao-atletas-${u.value}.xls`,document.body.appendChild(n),n.click(),n.remove(),window.URL.revokeObjectURL(t)}catch{g("Erro ao exportar arquivo.","danger")}finally{b.value=!1}}return V(async()=>{await _(),s.value.length>0&&c.value.length===0&&await y()}),(o,e)=>(i(),d("main",j,[a("div",B,[a("div",G,[e[7]||(e[7]=a("h1",{class:"fs-3"},"Gestao de atletas",-1)),a("p",null,[e[2]||(e[2]=w(" Existem ",-1)),a("strong",null,l(f.value),1),e[3]||(e[3]=w(" atletas que participaram dos campeonatos no ano de ",-1)),a("strong",null,l(u.value),1)]),a("form",{onSubmit:F(y,["prevent"]),class:"mb-3"},[a("div",$,[a("div",D,[e[4]||(e[4]=a("label",{for:"temporada",class:"form-label"},"Ano",-1)),x(a("input",{id:"temporada","onUpdate:modelValue":e[0]||(e[0]=t=>u.value=t),type:"number",class:"form-control",min:"2000",max:"2100"},null,512),[[M,u.value,void 0,{number:!0}]])]),a("div",q,[e[5]||(e[5]=a("label",{for:"id_temporada",class:"form-label"},"Temporadas",-1)),x(a("select",{id:"id_temporada","onUpdate:modelValue":e[1]||(e[1]=t=>s.value=t),multiple:"",class:"form-select","aria-label":"Lista de temporadas"},[(i(!0),d(k,null,E(m.value,t=>(i(),d("option",{key:t.id_temporada,value:t.id_temporada},l(t.campeonato),9,O))),128))],512),[[N,s.value]])]),a("div",Y,[a("button",{class:"btn btn-secondary",type:"submit",disabled:v.value},l(v.value?"Filtrando...":"Filtrar"),9,z)])])],32),a("div",H,[a("div",I,[a("button",{type:"button",class:"btn w-100 text-white btn-info",disabled:s.value.length===0||b.value,onClick:L},l(b.value?"Exportando...":"Exportar"),9,J)])]),p.value?(i(),d("div",K,l(p.value),1)):A("",!0),c.value.length>0?(i(),d("div",P,[a("table",Q,[e[6]||(e[6]=a("thead",null,[a("tr",null,[a("th"),a("th",null,"Atleta"),a("th",null,"RG"),a("th",null,"Clube/Escola"),a("th",null,"Campeonato")])],-1)),a("tbody",null,[(i(!0),d(k,null,E(c.value,(t,n)=>(i(),d("tr",{key:`${t.atleta}-${t.rg}-${n}`},[a("td",null,l(n+1),1),a("td",null,l(t.atleta),1),a("td",null,l(S(T)(t.rg)),1),a("td",null,l(t.escola),1),a("td",null,l(t.campeonato),1)]))),128))])])])):A("",!0)])])]))}});export{ea as default};
