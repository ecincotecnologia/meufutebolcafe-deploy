import{d as R,o as D,c as n,b as a,t as g,g as y,F as q,j as A,r as m,a as d,s as _,l as U,h as l,n as h,f as S,v as z,z as L,p as F}from"./index-CebFxVPd.js";const I={class:"container margin-top-navbar"},J={class:"row"},P={class:"col-12"},G={class:"fs-3"},H={key:0,class:"text-center py-4"},K={key:1,class:"alert alert-danger"},O={class:"card text-bg-dark border-secondary mb-3"},Q={key:0,class:"alert alert-info m-0"},W={key:1,class:"card-body text-secondary table-responsive"},X={class:"table table-dark table-striped text-nowrap mb-0"},Y={class:"align-middle"},Z=["onClick"],aa=["onUpdate:modelValue"],ea={class:"card text-bg-dark border-secondary mb-3"},sa={key:0,class:"alert alert-info m-0"},ta={key:1,class:"card-body text-secondary table-responsive"},oa={class:"table table-dark table-striped text-nowrap mb-0"},na={class:"align-middle"},la={class:"form-check"},ua=["onUpdate:modelValue","disabled"],ia=R({__name:"SumulaEquipeMandanteView",setup(da){const $=F(),E=U(),p=m(!1),v=m(""),r=m(0),C=m(0),k=m(0),x=m(""),b=m([]),f=m([]);function M(){return Number($.params.id)}async function j(){p.value=!0,v.value="";try{r.value=M();const{data:e}=await d.get(`/jogo/${r.value}`);C.value=Number(e?.id_temporada??0),k.value=Number(e?.id_equipe_mandante??0);const s=e?.equipe_mandante??e?.equipeMandante;x.value=`${s?.equipe?.nome??""} ${s?.complemento??""}`.trim();const[t,u,N]=await Promise.all([d.get(`/sumula/${r.value}/equipe/${k.value}/atletas`),d.get(`/sumula/${r.value}/equipe/${k.value}/comissao`),d.get(`/sumula/jogo/${r.value}`)]),w=new Map,B=Array.isArray(N.data)?N.data:[];for(const o of B){const i=Number(o.id_temporada_atleta??0);i>0&&w.set(i,o)}b.value=(Array.isArray(t.data)?t.data:[]).map(o=>{const i=Number(o.id_temporada_atleta??0),c=w.get(i);return{id_temporada_atleta:i,id_sumula:c?.id_sumula?Number(c.id_sumula):void 0,nome:String(o.nome??o.apelido??""),uniforme:String(c?.uniforme??o.uniforme??""),suspenso:Number(o.suspenso??0)}}),f.value=(Array.isArray(u.data)?u.data:[]).map(o=>{const i=Number(o.id_temporada_atleta??0),c=w.get(i);return{id_temporada_atleta:i,id_sumula:c?.id_sumula?Number(c.id_sumula):void 0,nome:String(o.nome??o.apelido??""),suspenso:Number(o.suspenso??0),relacionado:!!c?.id_sumula}})}catch{v.value="Erro ao carregar equipe mandante da sumula.",_("Erro ao carregar equipe mandante da sumula.","danger")}finally{p.value=!1}}async function V(e){try{await d.put(`/temporada-atleta/${e.id_temporada_atleta}/liberar-suspensao`,{motivo:"Liberado via sumula"}),e.suspenso=0,_("Atleta liberado com sucesso.","success")}catch{_("Erro ao liberar atleta.","danger")}}async function T(){if(confirm("Certifique-se de que todos atletas ja estao na sumula antes de salvar.")){p.value=!0;try{for(const e of b.value){const s=String(e.uniforme??"").trim(),t=e.suspenso===0&&s!=="";if(t&&!e.id_sumula){const{data:u}=await d.post("/sumula",{id_temporada_atleta:e.id_temporada_atleta,id_jogo:r.value,uniforme:Number(s),funcao:"1",cumprindo_suspensao:0});e.id_sumula=Number(u?.dados?.id_sumula??u?.id_sumula??0)||e.id_sumula}t&&e.id_sumula&&await d.put(`/sumula/${e.id_sumula}/numeracao`,{numero:Number(s)}),!t&&e.id_sumula&&(await d.delete(`/sumula/${e.id_sumula}`),e.id_sumula=void 0)}for(const e of f.value){const s=e.suspenso===0&&!!e.relacionado;if(s&&!e.id_sumula){const{data:t}=await d.post("/sumula",{id_temporada_atleta:e.id_temporada_atleta,id_jogo:r.value,funcao:"2",cumprindo_suspensao:0});e.id_sumula=Number(t?.dados?.id_sumula??t?.id_sumula??0)||e.id_sumula}!s&&e.id_sumula&&(await d.delete(`/sumula/${e.id_sumula}`),e.id_sumula=void 0)}_("Dados atualizados com sucesso.","success"),E.push({name:"jogo-sumula-futebol",params:{id:r.value}})}catch{_("Erro ao salvar dados da equipe mandante.","danger")}finally{p.value=!1}}}return D(()=>{j()}),(e,s)=>(l(),n("main",I,[a("div",J,[a("div",P,[s[5]||(s[5]=a("h5",null,"1. Equipe Mandante",-1)),a("h3",G,g(x.value),1),s[6]||(s[6]=a("div",{class:"progress mb-4",role:"progressbar","aria-valuenow":"33","aria-valuemin":"0","aria-valuemax":"100"},[a("div",{class:"progress-bar bg-info text-dark",style:{width:"33%"}},"33%")],-1)),s[7]||(s[7]=a("div",{class:"alert alert-warning"},[a("h2",{class:"text-danger fs-4"},"Importante!"),a("p",{class:"mb-0"},[y(" 1. Sempre faca o cadastro de atletas antes do lancamento dos resultados na sumula pois nao e possivel inclui-los apos este processo. "),a("br"),y("2. Se o atleta ou integrante da comissao tecnica nao esta aparecendo nesta lista, e porque ele ainda nao foi liberado. "),a("br"),y("3. Apenas atletas com numero de camisa entram na sumula. ")])],-1)),p.value?(l(),n("div",H,[...s[0]||(s[0]=[a("div",{class:"spinner-border"},null,-1)])])):v.value?(l(),n("div",K,g(v.value),1)):(l(),n(q,{key:2},[a("div",O,[s[2]||(s[2]=a("div",{class:"card-header"},[a("h5",{class:"mb-0"},"Atletas")],-1)),b.value.length===0?(l(),n("div",Q," Esta equipe nao possui atletas inscritos. ")):(l(),n("div",W,[a("table",X,[s[1]||(s[1]=a("thead",null,[a("tr",null,[a("th",{width:"90%"},"Nome"),a("th",{width:"10%"},"N Camisa")])],-1)),a("tbody",null,[(l(!0),n(q,null,A(b.value,t=>(l(),n("tr",{key:t.id_temporada_atleta},[a("td",Y,[y(g(t.nome)+" ",1),a("span",{class:h(["badge text-bg-danger ms-2",{"d-none":t.suspenso===0}])}," **Suspenso** ",2)]),a("td",null,[a("button",{type:"button",class:h(["btn btn-sm btn-success",{"d-none":t.suspenso===0}]),onClick:u=>V(t)}," Liberar ",10,Z),S(a("input",{type:"text",class:h(["form-control",{"d-none":t.suspenso===1}]),maxlength:"3","onUpdate:modelValue":u=>t.uniforme=u},null,10,aa),[[z,t.uniforme,void 0,{trim:!0}]])])]))),128))])])]))]),a("div",ea,[s[4]||(s[4]=a("div",{class:"card-header"},[a("h5",{class:"mb-0"},"Comissao Tecnica")],-1)),f.value.length===0?(l(),n("div",sa," Esta equipe nao possui integrantes da comissao tecnica inscritos. ")):(l(),n("div",ta,[a("table",oa,[s[3]||(s[3]=a("thead",null,[a("tr",null,[a("th",{width:"90%"},"Nome"),a("th",{width:"10%"},"Relacionar")])],-1)),a("tbody",null,[(l(!0),n(q,null,A(f.value,t=>(l(),n("tr",{key:t.id_temporada_atleta,class:h({"table-danger":t.suspenso===1})},[a("td",na,g(t.nome),1),a("td",null,[a("div",la,[S(a("input",{class:"form-check-input",type:"checkbox","onUpdate:modelValue":u=>t.relacionado=u,disabled:t.suspenso===1},null,8,ua),[[L,t.relacionado]])])])],2))),128))])])]))]),a("div",{class:"row g-3 mb-3"},[a("div",{class:"col"},[a("button",{class:"btn btn-success w-100",type:"button",onClick:T}," Salvar ")])])],64))])])]))}});export{ia as default};
