import{d as Re,u as Se,o as Ie,c as l,b as t,t as n,g as f,F as x,w as be,f as $,v as fe,y as ge,m as _e,j as P,e as _,k as Ge,r,B as v,a as u,s as i,l as Le,h as s,n as ke,q as ye,p as Pe}from"./index-CebFxVPd.js";import{m as Ue,s as U,a as Be}from"./mask-BwaD9nz2.js";const Fe={class:"container pb-4"},Ve={class:"row"},je={class:"col-12"},De={class:"fs-3"},Me={key:0,class:"text-center py-4"},Oe={key:1,class:"alert alert-danger"},We={key:0,class:"card border-light text-bg-dark mb-4"},Je={class:"card-body"},He={class:"mb-3"},Ke={class:"form-check form-check-inline"},Qe={class:"form-check form-check-inline"},Xe={class:"mt-3"},Ye=["disabled"],Ze={class:"row g-3"},we={key:0,class:"col-12 col-lg-6"},et=["value"],tt=["disabled"],at={key:1,class:"col-12 col-lg-6"},ot=["value"],lt=["disabled"],st={class:"table-responsive"},nt={class:"table table-dark text-nowrap"},it={key:0},rt=["onClick"],ut={key:0},dt={key:0,class:"text-success"},ct=["onClick"],mt=["onClick"],vt=["onClick"],pt=["disabled","onClick"],bt={class:"table-responsive"},ft={class:"table table-dark text-nowrap"},gt={key:0},_t={class:"form-check form-switch mt-1"},kt=["id","checked","onChange"],yt=["for"],At=["onClick"],Ct={key:0},ht={key:0,class:"text-success"},Nt=["onClick"],$t=["onClick"],zt=["onClick"],qt=["disabled","onClick"],xt={class:"row row-cols-1 row-cols-sm-2 g-2"},Et={class:"col"},Tt=["disabled"],Rt={class:"modal-dialog"},St={class:"modal-content"},It={class:"modal-header"},Gt={class:"modal-body"},Lt={class:"mb-3"},Pt={class:"mb-3"},Ut=["value"],Bt={class:"mb-3"},Ft=["value"],Vt={class:"modal-footer"},jt={key:1,class:"modal-backdrop fade show"},Wt=Re({__name:"TemporadaAtletaView",setup(Dt){const B=Pe(),J=Le(),H=Se(),F=r(!1),E=r(""),k=r(!1),T=r(!1),V=r(!1),K=r(!1),h=r(null),g=r(null),j=r([]),D=r([]),R=r([]),S=r([]),Q=r({}),p=r({rg:"",id_tipo:1}),m=r({id_atleta:0,id_comissao:0}),y=r(!1),N=r(""),z=r(null),A=v(()=>Number(B.params.id||0)),b=v(()=>Number(B.params.idTemporadaEquipe||B.params.idEquipe||0)),Ae=v(()=>g.value?.nome_completo||g.value?.nome||"Equipe"),X=v(()=>Number(h.value?.quantidade_atletas??0)),Y=v(()=>Number(h.value?.quantidade_comissao??0)),Z=v(()=>j.value.length),w=v(()=>D.value.length),ee=v(()=>Z.value<X.value),te=v(()=>w.value<Y.value),Ce=v(()=>{const o=h.value?.data_inscricao_atletas;return o?ye(o):"-"}),I=v(()=>Number(h.value?.campeonato?.id_modalidade??0)===6),ae=v(()=>Number(h.value?.autorizacao??0)===1),G=v(()=>[0,1].includes(H.nivel)&&ae.value);function C(o){return Number(o.id_temporada_atleta??o.id_atleta_clube??0)}function he(o){return Number(o.id_tipo??o.tipo??1)}function oe(o){return o.nome||o.apelido||"Atleta"}function le(o){return!o||o==="0000-00-00"?"Pendente":ye(o)}function se(o){return Be(o)}function ne(o){return o.nome||o.apelido||"Atleta"}function ie(o){return(Array.isArray(o)?o:[]).map(a=>({id_atleta:Number(a?.id_atleta??0),nome:String(a?.nome??""),apelido:String(a?.apelido??""),rg:String(a?.rg??"")})).filter(a=>a.id_atleta>0)}function re(o){return o.federado===!0||o.federado===1||o.federado==="Sim"}function M(o){const e=Number(o.id_atleta??0),a=Q.value[e];return o.autorizado_em||o.autorizado===!0||o.autorizado===1?!0:!!a?.autorizado_em}function O(o){const e=Number(o.id_atleta??0);return String(o.token??Q.value[e]?.token??"")}function W(o){return[0,1].includes(H.nivel)&&!o.liberado&&o.jogos===0}function ue(o){const e=Number(o.id_atleta??0);e>0&&J.push({name:"atleta-editar",params:{id:e}})}function Ne(){const o=J.resolve({name:"temporada-fichao",params:{id:A.value,idTemporadaEquipe:b.value},query:{}});window.open(o.href,"_blank")}async function $e(){T.value=!0;try{const o=await u.get(`/temporada/${A.value}/atletas-inscritos/excel`,{params:{id_temporada_equipe:b.value},responseType:"blob"}),e=new Blob([o.data],{type:"application/vnd.ms-excel;charset=utf-8"}),a=window.URL.createObjectURL(e),d=document.createElement("a"),q=o.headers["content-disposition"]?.match(/filename="?([^"]+)"?/);d.href=a,d.download=q?.[1]||`atletas-temporada-${A.value}.xls`,document.body.appendChild(d),d.click(),d.remove(),window.URL.revokeObjectURL(a)}catch{i("Erro ao exportar atletas inscritos.","danger")}finally{T.value=!1}}async function L(){if(!V.value){V.value=!0,F.value=!0,E.value="";try{const[o,e,a,d]=await Promise.all([u.get(`/temporada/${A.value}`),u.get(`/temporada/${A.value}/equipes`),u.get(`/temporada/${A.value}/equipe/${b.value}/atleta`),u.get(`/temporada/${A.value}/equipe/${b.value}/comissao`)]);h.value=o.data;const c=Array.isArray(e.data)?e.data:[];g.value=c.find(q=>Number(q.id_temporada_equipe)===b.value)||null,j.value=a.data??[],D.value=d.data??[],await ze()}catch{E.value="Erro ao carregar atletas da temporada.",i("Erro ao carregar atletas da temporada.","danger")}finally{F.value=!1,V.value=!1}}}async function ze(){try{const[o,e]=await Promise.all([u.get(`/temporada-atleta/${b.value}/atletas`),u.get(`/temporada-atleta/${b.value}/comissoes`)]);R.value=ie(o.data),S.value=ie(e.data),R.value.some(a=>a.id_atleta===Number(m.value.id_atleta))||(m.value.id_atleta=0),S.value.some(a=>a.id_atleta===Number(m.value.id_comissao))||(m.value.id_comissao=0)}catch{R.value=[],S.value=[]}}async function qe(o){const e=U(o,20);if(e.length<7)return null;const{data:a}=await u.get("/atleta");return(Array.isArray(a)?a:[]).find(q=>U(String(q?.rg??""),20)===e)||null}async function xe(){if(!p.value.rg||U(p.value.rg,20).length<7){i("Preencha o RG com pelo menos 7 numeros.","warning");return}k.value=!0;try{const o=await qe(p.value.rg);if(!o){i("Atleta nao encontrado pelo RG informado.","warning");return}if(await u.post("/temporada-atleta",{id_atleta:Number(o.id_atleta),id_temporada_equipe:b.value,id_tipo:Number(p.value.id_tipo),federado:!1,tempo_prova:null,obs:null}),Number(p.value.id_tipo)===1&&g.value?.id_equipe)try{await u.post("/elenco",{id_equipe:Number(g.value.id_equipe),id_atleta:Number(o.id_atleta)})}catch{}i("Inscricao realizada com sucesso.","success"),p.value.rg="",await L()}catch(o){const e=o?.response?.data?.mensagem||o?.response?.data?.message||"Erro ao inscrever atleta.";i(e,"danger")}finally{k.value=!1}}async function de(o,e){if(!o){i("Selecione um registro para inscrever.","warning");return}k.value=!0;try{if(await u.post("/temporada-atleta",{id_atleta:Number(o),id_temporada_equipe:b.value,id_tipo:Number(e),federado:!1,tempo_prova:null,obs:null}),e===1&&g.value?.id_equipe){try{await u.post("/elenco",{id_equipe:Number(g.value.id_equipe),id_atleta:Number(o)})}catch{}m.value.id_atleta=0}else m.value.id_comissao=0;i("Inscricao realizada com sucesso.","success"),await L()}catch(a){const d=a?.response?.data?.mensagem||a?.response?.data?.message||"Erro ao inscrever atleta.";i(d,"danger")}finally{k.value=!1}}async function ce(o){const e=C(o);if(!e)return;const a=!o.liberado;if(a&&ae.value&&!M(o)){i("Este atleta necessita de autorizacao para ser liberado.","warning");return}try{a?(await u.put(`/temporada-atleta/${e}/liberar`),o.liberado=1):(await u.put(`/temporada-atleta/${e}/bloquear`),o.liberado=0),i("Status atualizado com sucesso.","success")}catch{i("Erro ao atualizar status do atleta.","danger")}}async function Ee(o){const e=C(o);if(!e||!o.id_atleta)return;const a=!re(o);try{await u.put(`/temporada-atleta/${e}`,{id_atleta:Number(o.id_atleta),id_temporada_equipe:b.value,id_tipo:he(o),federado:a,tempo_prova:o.tempo_prova??null,obs:null}),o.federado=a?1:0,i("Federacao atualizada com sucesso.","success")}catch{i("Erro ao atualizar federacao do atleta.","danger")}}async function me(o){if(!W(o))return;const e=C(o);if(e&&confirm("Deseja realmente excluir esta inscricao?"))try{await u.delete(`/temporada-atleta/${e}`),i("Inscricao excluida com sucesso.","success"),await L()}catch{i("Erro ao excluir inscricao.","danger")}}async function ve(o){if(!(!o.id_atleta||!g.value?.id_equipe))try{const{data:e}=await u.post("/autorizacao",{id_atleta:Number(o.id_atleta),id_equipe:Number(g.value.id_equipe)});o.token=String(e?.dados?.token??e?.token??""),o.autorizado=0,o.autorizado_em=null,i("Autorizacao criada com sucesso.","success")}catch(e){const a=e?.response?.data?.mensagem||e?.response?.data?.message||"Falha ao criar autorizacao.";i(a,"danger")}}function pe(o){const e=O(o);e&&(z.value={nome:oe(o),token:e},N.value="",y.value=!0)}function Te(){const o=z.value?.token||"",e=z.value?.nome||"",a=U(N.value,11);if(a.length<10){i("Preencha corretamente o numero do WhatsApp.","warning");return}if(!o){i("Token invalido.","warning");return}const d=`Por favor, realize a autorizacao da participacao do atleta ${e} pelo link: https://futebolcafe.com.br/autorizacao/${o}`,c=`https://wa.me/55${a}?text=${encodeURIComponent(d)}`;window.open(c,"_blank"),y.value=!1}return Ie(()=>{K.value||(K.value=!0,L())}),(o,e)=>(s(),l("main",Fe,[t("div",Ve,[t("div",je,[t("h3",De,n(Ae.value),1),t("p",null,[e[12]||(e[12]=f(" Inscrições permitidas até ",-1)),t("strong",null,n(Ce.value),1),e[13]||(e[13]=t("br",null,null,-1)),e[14]||(e[14]=f(" Atletas inscritos: ",-1)),t("strong",null,n(Z.value),1),e[15]||(e[15]=f(" de ",-1)),t("strong",null,n(X.value),1),e[16]||(e[16]=f(" permitidos.",-1)),e[17]||(e[17]=t("br",null,null,-1)),e[18]||(e[18]=f(" Comissão Técnica: ",-1)),t("strong",null,n(w.value),1),e[19]||(e[19]=f(" de ",-1)),t("strong",null,n(Y.value),1),e[20]||(e[20]=f(" permitidos. ",-1))]),F.value?(s(),l("div",Me,[...e[21]||(e[21]=[t("div",{class:"spinner-border"},null,-1)])])):E.value?(s(),l("div",Oe,n(E.value),1)):(s(),l(x,{key:2},[ee.value||te.value?(s(),l("div",We,[t("div",Je,[e[29]||(e[29]=t("h5",null,"Inscrever atleta",-1)),t("form",{onSubmit:be(xe,["prevent"])},[t("div",He,[e[22]||(e[22]=t("label",{class:"form-label"},"RG (Sem os pontos ou tracos)",-1)),$(t("input",{"onUpdate:modelValue":e[0]||(e[0]=a=>p.value.rg=a),type:"text",class:"form-control",maxlength:"15",placeholder:"RG"},null,512),[[fe,p.value.rg,void 0,{trim:!0}]])]),t("div",Ke,[$(t("input",{id:"tipo-atleta","onUpdate:modelValue":e[1]||(e[1]=a=>p.value.id_tipo=a),class:"form-check-input",type:"radio",value:1},null,512),[[ge,p.value.id_tipo,void 0,{number:!0}]]),e[23]||(e[23]=t("label",{class:"form-check-label",for:"tipo-atleta"},"Atleta",-1))]),t("div",Qe,[$(t("input",{id:"tipo-comissao","onUpdate:modelValue":e[2]||(e[2]=a=>p.value.id_tipo=a),class:"form-check-input",type:"radio",value:2},null,512),[[ge,p.value.id_tipo,void 0,{number:!0}]]),e[24]||(e[24]=t("label",{class:"form-check-label",for:"tipo-comissao"},"Comissão Técnica",-1))]),t("div",Xe,[t("button",{class:"btn btn-success",disabled:k.value},n(k.value?"Consultando...":"Inscrever por RG"),9,Ye)])],32),e[30]||(e[30]=t("hr",null,null,-1)),t("div",Ze,[ee.value?(s(),l("div",we,[e[26]||(e[26]=t("label",{class:"form-label"},"Atletas Disponíveis",-1)),$(t("select",{"onUpdate:modelValue":e[3]||(e[3]=a=>m.value.id_atleta=a),class:"form-select"},[e[25]||(e[25]=t("option",{value:0},"Selecione um atleta",-1)),(s(!0),l(x,null,P(R.value,a=>(s(),l("option",{key:`atleta-apto-${a.id_atleta}`,value:a.id_atleta},n(ne(a)),9,et))),128))],512),[[_e,m.value.id_atleta,void 0,{number:!0}]]),t("button",{class:"btn btn-success mt-2 w-100",disabled:k.value||!m.value.id_atleta,onClick:e[4]||(e[4]=a=>de(Number(m.value.id_atleta),1))}," Inscrever atleta selecionado ",8,tt)])):_("",!0),te.value?(s(),l("div",at,[e[28]||(e[28]=t("label",{class:"form-label"},"Comissão técnica",-1)),$(t("select",{"onUpdate:modelValue":e[5]||(e[5]=a=>m.value.id_comissao=a),class:"form-select"},[e[27]||(e[27]=t("option",{value:0},"Selecione um integrante",-1)),(s(!0),l(x,null,P(S.value,a=>(s(),l("option",{key:`comissao-apta-${a.id_atleta}`,value:a.id_atleta},n(ne(a)),9,ot))),128))],512),[[_e,m.value.id_comissao,void 0,{number:!0}]]),t("button",{class:"btn btn-success mt-2 w-100",disabled:k.value||!m.value.id_comissao,onClick:e[6]||(e[6]=a=>de(Number(m.value.id_comissao),2))}," Inscrever integrante selecionado ",8,lt)])):_("",!0)])])])):_("",!0),e[51]||(e[51]=t("h5",{class:"mt-4"},"Orientações",-1)),e[52]||(e[52]=t("p",null,[f(' . Apenas atletas e integrantes da comissão técnica com status de "liberado" são listados na súmula e fichão. '),t("br"),f('. Apenas é permitido excluir atletas que estão com o status de "não liberado" e que não tenham participado de algum jogo na súmula. ')],-1)),t("div",st,[e[40]||(e[40]=t("h5",{class:"mt-4"},"Comissao Técnica",-1)),t("table",nt,[t("thead",null,[t("tr",null,[e[31]||(e[31]=t("th",null,null,-1)),e[32]||(e[32]=t("th",null,"Nome",-1)),e[33]||(e[33]=t("th",null,"RG",-1)),e[34]||(e[34]=t("th",null,"Nascimento",-1)),t("th",null,n(I.value?"Tempo Prova":"Jogos"),1),e[35]||(e[35]=t("th",null,null,-1)),G.value?(s(),l("th",it)):_("",!0),e[36]||(e[36]=t("th",null,null,-1)),e[37]||(e[37]=t("th",null,null,-1))])]),t("tbody",null,[(s(!0),l(x,null,P(D.value,(a,d)=>(s(),l("tr",{key:C(a)},[t("td",null,n(d+1),1),t("td",null,n(a.nome),1),t("td",null,n(se(a.rg)),1),t("td",null,n(le(a.nascimento)),1),t("td",null,n(I.value?a.tempo_prova??"-":a.jogos),1),t("td",null,[t("button",{class:ke(["btn",a.liberado?"btn-success":"btn-danger"]),onClick:c=>ce(a)},n(a.liberado?"Liberado":"Bloqueado"),11,rt)]),G.value?(s(),l("td",ut,[M(a)?(s(),l("span",dt," Autorizado ")):O(a)?(s(),l("button",{key:1,class:"btn btn-info",onClick:c=>pe(a)}," Enviar Autorização ",8,ct)):(s(),l("button",{key:2,class:"btn btn-primary",onClick:c=>ve(a)}," Gerar Autorização ",8,mt))])):_("",!0),t("td",null,[t("button",{class:"btn btn-secondary",onClick:c=>ue(a)},[...e[38]||(e[38]=[t("i",{class:"bi bi-pencil-square"},null,-1)])],8,vt)]),t("td",null,[t("button",{class:"btn btn-danger",disabled:!W(a),onClick:c=>me(a)},[...e[39]||(e[39]=[t("i",{class:"bi bi-trash-fill"},null,-1)])],8,pt)])]))),128))])])]),t("div",bt,[e[50]||(e[50]=t("h5",{class:"mt-4"},"Atletas",-1)),t("table",ft,[t("thead",null,[t("tr",null,[e[41]||(e[41]=t("th",null,null,-1)),e[42]||(e[42]=t("th",null,"Nome",-1)),e[43]||(e[43]=t("th",null,"RG",-1)),e[44]||(e[44]=t("th",null,"Nascimento",-1)),t("th",null,n(I.value?"Tempo Prova":"Jogos"),1),e[45]||(e[45]=t("th",null,null,-1)),G.value?(s(),l("th",gt)):_("",!0),e[46]||(e[46]=t("th",null,null,-1)),e[47]||(e[47]=t("th",null,null,-1))])]),t("tbody",null,[(s(!0),l(x,null,P(j.value,(a,d)=>(s(),l("tr",{key:C(a)},[t("td",null,n(d+1),1),t("td",null,[f(n(oe(a))+" ",1),t("div",_t,[t("input",{id:`federado_${C(a)}`,class:"form-check-input",type:"checkbox",checked:re(a),onChange:c=>Ee(a)},null,40,kt),t("label",{class:"form-check-label",for:`federado_${C(a)}`}," Federado ",8,yt)])]),t("td",null,n(se(a.rg)),1),t("td",null,n(le(a.nascimento)),1),t("td",null,n(I.value?a.tempo_prova??"-":a.jogos),1),t("td",null,[t("button",{class:ke(["btn",a.liberado?"btn-success":"btn-danger"]),onClick:c=>ce(a)},n(a.liberado?"Liberado":"Bloqueado"),11,At)]),G.value?(s(),l("td",Ct,[M(a)?(s(),l("span",ht," Autorizado ")):O(a)?(s(),l("button",{key:1,class:"btn btn-info",onClick:c=>pe(a)}," Enviar Autorização ",8,Nt)):(s(),l("button",{key:2,class:"btn btn-primary",onClick:c=>ve(a)}," Gerar Autorização ",8,$t))])):_("",!0),t("td",null,[t("button",{class:"btn btn-secondary",onClick:c=>ue(a)},[...e[48]||(e[48]=[t("i",{class:"bi bi-pencil-square"},null,-1)])],8,zt)]),t("td",null,[t("button",{class:"btn btn-danger",disabled:!W(a),onClick:c=>me(a)},[...e[49]||(e[49]=[t("i",{class:"bi bi-trash-fill"},null,-1)])],8,qt)])]))),128))])])]),t("div",xt,[t("div",{class:"col"},[t("button",{class:"btn btn-primary w-100",onClick:Ne}," Gerar Fichão ")]),t("div",Et,[t("button",{class:"btn btn-info w-100",disabled:T.value,onClick:$e},n(T.value?"Exportando...":"Exportar"),9,Tt)])])],64))])]),y.value?(s(),l("div",{key:0,class:"modal fade show d-block",tabindex:"-1",role:"dialog","aria-modal":"true",onClick:e[11]||(e[11]=be(a=>y.value=!1,["self"]))},[t("div",Rt,[t("div",St,[t("div",It,[e[53]||(e[53]=t("h5",{class:"modal-title"},"Enviar autorizacao",-1)),t("button",{type:"button",class:"btn-close",onClick:e[7]||(e[7]=a=>y.value=!1)})]),t("div",Gt,[t("div",Lt,[e[54]||(e[54]=t("label",{class:"form-label"},"WhatsApp",-1)),$(t("input",{"onUpdate:modelValue":e[8]||(e[8]=a=>N.value=a),type:"text",class:"form-control",onInput:e[9]||(e[9]=a=>N.value=Ge(Ue)(N.value))},null,544),[[fe,N.value]])]),t("div",Pt,[e[55]||(e[55]=t("label",{class:"form-label"},"Atleta",-1)),t("input",{value:z.value?.nome??"",type:"text",class:"form-control",readonly:""},null,8,Ut)]),t("div",Bt,[e[56]||(e[56]=t("label",{class:"form-label"},"Token",-1)),t("input",{value:z.value?.token??"",type:"text",class:"form-control",readonly:""},null,8,Ft)])]),t("div",Vt,[t("button",{type:"button",class:"btn btn-secondary",onClick:e[10]||(e[10]=a=>y.value=!1)},"Fechar"),t("button",{type:"button",class:"btn btn-primary",onClick:Te},"Enviar")])])])])):_("",!0),y.value?(s(),l("div",jt)):_("",!0)]))}});export{Wt as default};
