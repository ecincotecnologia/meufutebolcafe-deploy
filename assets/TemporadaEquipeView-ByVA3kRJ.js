import{d as fe,u as ge,o as qe,c as n,b as a,t as r,n as L,e as x,w as R,f as y,m as j,F as q,j as C,g as B,v as F,r as i,B as E,a as p,s as m,l as ye,h as l,p as Ee,q as O}from"./index-CebFxVPd.js";const _e={class:"container pb-4"},we={class:"row"},he={class:"col-12"},ke={class:"lead mb-2"},xe={class:"card text-bg-dark shadow-sm mb-3"},Ce={class:"card-body"},$e={class:"mb-3"},Ne=["value"],Te={class:"mb-3"},Ae=["value"],Ue=["disabled"],Se={class:"d-flex gap-2 flex-wrap mb-3"},Me={key:1,class:"text-center py-4"},je={key:2,class:"alert alert-danger"},Be={key:0,class:"alert alert-warning my-4"},De={class:"mt-4"},Pe={class:"table-responsive"},Ve={class:"table table-dark table-striped text-nowrap"},Ie={class:"text-end"},ze=["onClick"],Le=["onClick"],Re=["disabled","onClick"],Fe=["onClick"],Oe={class:"modal-dialog modal-dialog-centered"},Ge={class:"modal-content bg-dark"},Je={class:"modal-body"},Qe={class:"mb-3"},He={class:"mb-3"},Ke=["value"],We={class:"mb-3"},Xe=["value"],Ye={class:"mb-3"},Ze={class:"modal-footer justify-content-between"},ea=["disabled"],aa={key:1,class:"modal-backdrop fade show"},na=fe({__name:"TemporadaEquipeView",setup(oa){const G=Ee(),D=ye(),J=ge(),P=i(!1),$=i(""),N=i(!1),_=i(!1),T=i(null),f=i(null),w=i([]),A=i([]),u=i({id_equipe:null,complemento:""}),h=i(!1),c=i(""),v=i("info"),I=i([]),U=i([]),s=i({nome:"",estado:"",cidade:"",bairro:""}),Q=["A","B","C","D","E","F"],b=E(()=>Number(G.params.id||0)),H=E(()=>`${f.value?.campeonato?.campeonato??f.value?.campeonato??"Temporada"} - Equipes`),K=E(()=>{const t=f.value?.campeonato?.modalidade?.modalidade??f.value?.modalidade??"",e=f.value?.campeonato?.categoria?.categoria??f.value?.categoria??"";return[t,e].filter(Boolean).join(" - ")}),V=E(()=>{const t=f.value?.data_inscricao_equipes??"";if(!t)return"";const e=new Date(`${t}T23:59:59`),o=new Date;return Number.isNaN(e.getTime())?"":o>e?`Prazo de inscricao de equipes encerrado em ${O(t)}.`:`Inscricao de equipes aberta ate ${O(t)}.`}),W=E(()=>V.value.includes("encerrado")?"alert-warning":"alert-success"),X=E(()=>v.value==="danger"?"alert-danger":v.value==="success"?"alert-success":"alert-info");function g(t){return Number(t.id_temporada_equipe??t.id_temporada_clube??0)}function Y(t){return Number(t.atletas??0)}function Z(t){return Number(t.jogos??0)}function ee(t){const e=t.nome??`Equipe #${t.id_equipe}`;return!t.cidade||!t.estado?e:`${e} - ${t.cidade} (${t.estado})`}function ae(t){const e=t.equipe?.nome??t.nome??"Equipe",o=String(t.complemento??"").trim();return o?`${e} ${o}`:e}function oe(t){const e=t.trim().split(/\s+/).filter(Boolean);return e.length===0?"EQU":e.length===1?String(e[0]??"").slice(0,3).toUpperCase():e.slice(0,3).map(o=>o.charAt(0)).join("").toUpperCase()}function te(t){return[0,1].includes(J.nivel)&&Y(t)===0&&Z(t)===0}function se(){D.push({name:"temporada-grupo",params:{id:b.value}})}function ne(t){const e=g(t);D.push({name:"temporada-atleta",params:{id:b.value,idTemporadaEquipe:e}})}function le(t){const e=g(t);if(!e)return;const o=D.resolve({name:"temporada-fichao",params:{id:b.value,idTemporadaEquipe:e},query:{}});window.open(o.href,"_blank")}async function re(t){const e=g(t);if(e){T.value=e;try{const o=await p.get(`/temporada/${b.value}/atletas-inscritos/excel`,{params:{id_temporada_equipe:e},responseType:"blob"}),d=new Blob([o.data],{type:"application/vnd.ms-excel;charset=utf-8"}),M=window.URL.createObjectURL(d),k=document.createElement("a"),be=o.headers["content-disposition"]?.match(/filename=\"?([^\"]+)\"?/);k.href=M,k.download=be?.[1]||`atletas-temporada-${b.value}-equipe-${e}.xls`,document.body.appendChild(k),k.click(),k.remove(),window.URL.revokeObjectURL(M)}catch{m("Erro ao exportar atletas inscritos.","danger")}finally{T.value=null}}}function z(){_.value||(h.value=!1,c.value="")}async function ie(){try{const{data:t}=await p.get("/estado");I.value=Array.isArray(t)?t:[]}catch{m("Erro ao carregar estados.","danger")}}async function ue(){if(s.value.cidade="",!s.value.estado){U.value=[];return}try{const{data:t}=await p.get(`/municipio/${s.value.estado}`);U.value=Array.isArray(t)?t:[]}catch{m("Erro ao carregar cidades.","danger")}}function de(){if(!w.value.length){u.value.id_equipe=null;return}const t=new Set(w.value.map(e=>Number(e.id_equipe)));(!u.value.id_equipe||!t.has(Number(u.value.id_equipe)))&&(u.value.id_equipe=Number(w.value[0]?.id_equipe??0)||null)}function ce(t){return Array.isArray(t)?t:Array.isArray(t?.equipes)?t.equipes:[]}async function S(){P.value=!0,$.value="";try{const[t,e,o]=await Promise.all([p.get(`/temporada/${b.value}`),p.get(`/temporada/${b.value}/equipes`),p.get("/equipe")]);f.value=t.data,A.value=ce(e.data),w.value=Array.isArray(o.data)?o.data:[],de()}catch{$.value="Erro ao carregar equipes da temporada.",m("Erro ao carregar equipes da temporada.","danger")}finally{P.value=!1}}async function pe(){if(!u.value.id_equipe){m("Selecione uma equipe para inscrever.","warning");return}N.value=!0;const t={id_temporada:b.value,id_equipe:Number(u.value.id_equipe),complemento:u.value.complemento||null};try{await p.post("/temporada/equipe",t),m("Equipe inscrita com sucesso.","success"),await S()}catch(e){const o=e?.response?.data?.mensagem||e?.response?.data?.message||"Erro ao inscrever equipe.";m(o,"danger")}finally{N.value=!1}}async function me(){if(!s.value.nome){c.value="Preencha o nome.",v.value="danger";return}if(!s.value.estado){c.value="Selecione um estado.",v.value="danger";return}if(!s.value.cidade){c.value="Selecione uma cidade.",v.value="danger";return}if(!s.value.bairro){c.value="Preencha o bairro.",v.value="danger";return}_.value=!0,c.value="Processando as informacoes...",v.value="info";const t={nome:s.value.nome,sigla:oe(s.value.nome),estado:s.value.estado,cidade:s.value.cidade,bairro:s.value.bairro};try{const{data:e}=await p.post("/equipe",t),o=Number(e?.id_equipe??0);c.value="Equipe cadastrada com sucesso.",v.value="success",m("Equipe cadastrada com sucesso.","success"),s.value={nome:"",estado:"",cidade:"",bairro:""},U.value=[],await S(),o>0&&(u.value.id_equipe=o),h.value=!1}catch(e){const o=e?.response?.data?.mensagem||e?.response?.data?.message||"Erro ao cadastrar equipe.";c.value=o,v.value="danger"}finally{_.value=!1}}async function ve(t){const e=g(t);if(!(!e||!window.confirm("Antes de excluir este time, cadastre o time novo e altere seus jogos. Deseja realmente excluir este time agora?")))try{try{await p.delete(`/temporada-equipe/${e}`)}catch(d){if(![404,405].includes(Number(d?.response?.status)))throw d;await p.delete(`/temporada/${b.value}/equipe/${e}`)}m("Equipe excluida com sucesso.","success"),await S()}catch(d){const M=d?.response?.data?.mensagem||d?.response?.data?.message||"Erro ao excluir equipe.";m(M,"danger")}}return qe(async()=>{await Promise.all([S(),ie()])}),(t,e)=>(l(),n("main",_e,[a("div",we,[a("div",he,[a("h3",null,r(H.value),1),a("p",ke,r(K.value),1),V.value?(l(),n("div",{key:0,class:L(["alert",W.value])},r(V.value),3)):x("",!0),a("div",xe,[a("div",Ce,[e[10]||(e[10]=a("h5",{class:"card-title"},"Equipes disponiveis:",-1)),a("form",{onSubmit:R(pe,["prevent"])},[a("div",$e,[e[7]||(e[7]=a("label",{class:"form-label"},"Equipe",-1)),y(a("select",{"onUpdate:modelValue":e[0]||(e[0]=o=>u.value.id_equipe=o),class:"form-control",required:""},[(l(!0),n(q,null,C(w.value,o=>(l(),n("option",{key:o.id_equipe,value:o.id_equipe},r(ee(o)),9,Ne))),128))],512),[[j,u.value.id_equipe]])]),a("div",Te,[e[9]||(e[9]=a("label",{class:"form-label"},"Complemento: (Ex: Time A, Time B)",-1)),y(a("select",{"onUpdate:modelValue":e[1]||(e[1]=o=>u.value.complemento=o),class:"form-select"},[e[8]||(e[8]=a("option",{value:""},"Apenas uma equipe",-1)),(l(),n(q,null,C(Q,o=>a("option",{key:o,value:o}," Time "+r(o),9,Ae)),64))],512),[[j,u.value.complemento]])]),a("button",{type:"submit",class:"btn w-100 btn-success",disabled:N.value||!u.value.id_equipe},r(N.value?"Inscrevendo...":"Inscrever"),9,Ue)],32)])]),a("div",Se,[a("button",{type:"button",class:"btn btn-primary",onClick:e[2]||(e[2]=o=>h.value=!0)}," Cadastrar uma nova equipe "),a("button",{type:"button",class:"btn btn-primary",onClick:se},[...e[11]||(e[11]=[a("i",{class:"bi bi-box-arrow-right me-1"},null,-1),B(" Organizar os Grupos ",-1)])])]),P.value?(l(),n("div",Me,[...e[12]||(e[12]=[a("div",{class:"spinner-border"},null,-1)])])):$.value?(l(),n("div",je,r($.value),1)):(l(),n(q,{key:3},[A.value.length===0?(l(),n("div",Be," Nenhuma equipe esta cadastrada ")):(l(),n(q,{key:1},[a("p",De,[e[13]||(e[13]=B(" Este campeonato possui ",-1)),a("strong",null,r(A.value.length),1),e[14]||(e[14]=B(" equipes inscritas. ",-1))]),e[17]||(e[17]=a("p",null,"So e permitido excluir equipes que nao possuam atletas inscritos e sem jogos cadastrados.",-1)),a("div",Pe,[a("table",Ve,[e[16]||(e[16]=a("thead",null,[a("tr",null,[a("th",null,"Equipe"),a("th")])],-1)),a("tbody",null,[(l(!0),n(q,null,C(A.value,o=>(l(),n("tr",{key:g(o)},[a("td",null,r(ae(o)),1),a("td",Ie,[a("button",{class:"btn btn-info text-white",onClick:d=>ne(o)}," Elenco ("+r(o.total_integrantes_liberados)+" integrantes) ",9,ze),a("button",{class:"btn btn-primary ms-1",onClick:d=>le(o)}," FichÃ£o ",8,Le),a("button",{class:"btn btn-secondary ms-1",disabled:T.value===g(o),onClick:d=>re(o)},r(T.value===g(o)?"Exportando...":"Exportar Excel"),9,Re),te(o)?(l(),n("button",{key:0,class:"btn btn-danger ms-1",onClick:d=>ve(o)},[...e[15]||(e[15]=[a("i",{class:"bi bi-trash-fill"},null,-1)])],8,Fe)):x("",!0)])]))),128))])])])],64))],64))])]),h.value?(l(),n("div",{key:0,class:"modal fade show d-block",tabindex:"-1",role:"dialog","aria-modal":"true",onClick:R(z,["self"])},[a("div",Oe,[a("div",Ge,[a("div",{class:"modal-header"},[e[18]||(e[18]=a("h5",{class:"modal-title"},"Cadastro de Equipe",-1)),a("button",{type:"button",class:"btn-close btn-close-white",onClick:z})]),a("div",Je,[e[25]||(e[25]=a("p",{class:"text-info"},"Todos os campos sao de preenchimento obrigatorio",-1)),a("div",Qe,[e[19]||(e[19]=a("label",{class:"form-label"},"Nome da Equipe",-1)),y(a("input",{"onUpdate:modelValue":e[3]||(e[3]=o=>s.value.nome=o),type:"text",class:"form-control",maxlength:"50",minlength:"3"},null,512),[[F,s.value.nome,void 0,{trim:!0}]])]),e[26]||(e[26]=a("h5",null,"Localizacao",-1)),a("div",He,[e[21]||(e[21]=a("label",{class:"form-label"},"Estado",-1)),y(a("select",{"onUpdate:modelValue":e[4]||(e[4]=o=>s.value.estado=o),class:"form-control",onChange:ue},[e[20]||(e[20]=a("option",{value:""},"Escolha uma opcao",-1)),(l(!0),n(q,null,C(I.value,o=>(l(),n("option",{key:o.Uf,value:o.Uf},r(o.Nome),9,Ke))),128))],544),[[j,s.value.estado]])]),a("div",We,[e[23]||(e[23]=a("label",{class:"form-label"},"Cidade",-1)),y(a("select",{"onUpdate:modelValue":e[5]||(e[5]=o=>s.value.cidade=o),class:"form-control"},[e[22]||(e[22]=a("option",{value:""},"Escolha uma opcao",-1)),(l(!0),n(q,null,C(U.value,o=>(l(),n("option",{key:o.Nome,value:o.Nome},r(o.Nome),9,Xe))),128))],512),[[j,s.value.cidade]])]),a("div",Ye,[e[24]||(e[24]=a("label",{class:"form-label"},"Bairro",-1)),y(a("input",{"onUpdate:modelValue":e[6]||(e[6]=o=>s.value.bairro=o),type:"text",class:"form-control",maxlength:"50"},null,512),[[F,s.value.bairro,void 0,{trim:!0}]])])]),a("div",Ze,[c.value?(l(),n("div",{key:0,class:L(["alert m-0 py-2 px-3",X.value])},r(c.value),3)):x("",!0),a("button",{type:"button",class:"btn btn-success",disabled:_.value,onClick:me},[e[27]||(e[27]=a("i",{class:"bi bi-check me-1"},null,-1)),B(" "+r(_.value?"Salvando...":"Confirmar"),1)],8,ea)])])])])):x("",!0),h.value?(l(),n("div",aa)):x("",!0)]))}});export{na as default};
